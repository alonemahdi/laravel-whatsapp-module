# راهنمای تست‌ها

این پوشه شامل تست‌های واحد برای ماژول واتساپ است.

## ساختار تست‌ها

### 1. WhatsAppServiceTest.php
تست‌های Mock شده که از HTTP Fake استفاده می‌کنند. این تست‌ها سریع هستند و نیازی به اتصال واقعی به API ندارند.

### 2. WhatsAppServiceRealTest.php
تست‌های واقعی که با API واقعی ارتباط برقرار می‌کنند. این تست‌ها نیاز به تنظیم متغیرهای محیطی دارند.

## اجرای تست‌ها

### تست‌های Mock (پیشنهادی)
```bash
vendor/bin/phpunit
```

### تست‌های واقعی
برای اجرای تست‌های واقعی، ابتدا فایل `.env` یا متغیرهای محیطی را تنظیم کنید:

```env
TEST_WHATSAPP_API_KEY=your_real_api_key
TEST_WHATSAPP_SENDER=989123456789
TEST_WHATSAPP_NUMBER=989123456780
TEST_WHATSAPP_USERNAME=your_username
```

سپس تست‌ها را اجرا کنید:
```bash
vendor/bin/phpunit tests/WhatsAppServiceRealTest.php
```

## تست‌های موجود

### تست‌های Mock
- ✅ ارسال پیام متنی
- ✅ ارسال رسانه
- ✅ ارسال نظرسنجی
- ✅ ارسال استیکر
- ✅ ارسال دکمه
- ✅ تولید QR Code
- ✅ قطع اتصال دستگاه
- ✅ دریافت اطلاعات کاربر
- ✅ دریافت اطلاعات دستگاه
- ✅ ایجاد دستگاه جدید
- ✅ بررسی شماره
- ✅ اعتبارسنجی‌ها و خطاها
- ✅ Facade

### تست‌های واقعی
- ✅ بررسی شماره
- ✅ دریافت اطلاعات کاربر
- ✅ دریافت اطلاعات دستگاه
- ✅ ارسال پیام متنی (با بررسی قبلی)

## نکات مهم

1. **تست‌های واقعی**: این تست‌ها ممکن است هزینه‌بر باشند و باید با احتیاط استفاده شوند.

2. **قبل از ارسال پیام**: تست `test_real_send_message` ابتدا بررسی می‌کند که شماره مقصد واتساپ دارد یا نه.

3. **Skip کردن تست‌ها**: اگر متغیرهای محیطی تنظیم نشده باشند، تست‌های واقعی به صورت خودکار skip می‌شوند.

4. **خروجی**: تست‌های واقعی اطلاعات مفیدی در خروجی نمایش می‌دهند.

